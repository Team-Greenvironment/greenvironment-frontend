<div id="profile-page">
  <div id="profilecontainer" *ngIf="!groupNotFound && !loading">
    <!--on small screen-->
    <mat-toolbar id="toolbar" fxShow="true" fxHide.gt-sm="true">
      <mat-toolbar-row>
        <div class="hover-box" matTooltip="upload new picture" *ngIf="isAdmin" (click)="openFileUploadDialog()">
          <img class="profile-picture" [src]="groupProfile.picture"/>
          <mat-icon id="icon">camera_alt</mat-icon>
        </div>
        <div *ngIf="!isAdmin" (click)="openPfpLightbox()">
          <img class="profile-picture" [src]="groupProfile.picture"/>
        </div>

        <span id="username">{{groupProfile.name}}</span>
        <div class="button-box">
          <button mat-icon-button *ngIf="!groupProfile.joined"
                  class="request-button"
                  matTooltip="join group" matTooltipShowDelay="500"
                  (click)="joinGroup(groupProfile)"
                  [disabled]="!groupProfile.allowedToJoinGroup">
            <mat-icon>group_add</mat-icon>
          </button>
          <button mat-icon-button *ngIf="groupProfile.joined"
                  class="request-button"
                  matTooltip="leave group" matTooltipShowDelay="500"
                  (click)="leaveGroup(groupProfile)">
            <mat-icon>directions_run</mat-icon>
          </button>
          <button mat-icon-button
                  class="request-button"
                  matTooltip="create event" matTooltipShowDelay="500"
                  (click)="openDialog()"
                  [disabled]="!isAdmin">
            <mat-icon>event</mat-icon>
          </button>
          <div style="display: contents;" *ngIf="groupProfile.deletable">
            <button mat-icon-button
                    class="request-button"
                    matTooltip="delete this group" matTooltipShowDelay="0"
                    (click)="deleteGroup()">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>
      </mat-toolbar-row>
      <mat-toolbar-row>
        <div class="info-box">
          <span id="handle" class="pointer"
                (click)="showUserProfile(groupProfile.creator)">created by {{groupProfile.creator.username}}
            @{{groupProfile.creator.handle}}</span>
        </div>
      </mat-toolbar-row>
      <mat-toolbar-row>
        <div class="info-box">
          <span class="info">{{groupProfile.members.length}} member(s)</span>
        </div>
      </mat-toolbar-row>
    </mat-toolbar>
    <!--on big screen-->
    <mat-toolbar id="toolbar" fxShow="true" fxHide.lt-md="true">
      <mat-toolbar-row>
        <div class="hover-box" matTooltip="upload new picture" *ngIf="isAdmin" (click)="openFileUploadDialog()">
          <img class="profile-picture" [src]="groupProfile.picture"/>
          <mat-icon id="icon">camera_alt</mat-icon>
        </div>
        <div *ngIf="!isAdmin" (click)="openPfpLightbox()">
          <img class="profile-picture" [src]="groupProfile.picture"/>
        </div>
        <span id="username">{{groupProfile.name}}</span>
        <span id="handle" class="pointer"
              (click)="showUserProfile(groupProfile.creator)">created by {{groupProfile.creator.username}}
          @{{groupProfile.creator.handle}}</span>
        <div class="button-box">
          <button mat-icon-button *ngIf="!groupProfile.joined"
                  class="request-button"
                  matTooltip="join group" matTooltipShowDelay="500"
                  (click)="joinGroup(groupProfile)"
                  [disabled]="!groupProfile.allowedToJoinGroup">
            <mat-icon>group_add</mat-icon>
          </button>
          <button mat-icon-button *ngIf="groupProfile.joined"
                  class="request-button"
                  matTooltip="leave group" matTooltipShowDelay="500"
                  (click)="leaveGroup(groupProfile)">
            <mat-icon>directions_run</mat-icon>
          </button>
          <button mat-icon-button
                  class="request-button"
                  matTooltip="create event" matTooltipShowDelay="500"
                  (click)="openDialog()"
                  [disabled]="!isAdmin">
            <mat-icon>event</mat-icon>
          </button>
          <div style="display: contents;" *ngIf="groupProfile.deletable">
            <button mat-icon-button
                    class="request-button"
                    matTooltip="delete this group" matTooltipShowDelay="0"
                    (click)="deleteGroup()">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>
      </mat-toolbar-row>
      <mat-toolbar-row>
        <div class="info-box">
          <span class="info">{{groupProfile.members.length}} member(s)</span>
        </div>
      </mat-toolbar-row>
    </mat-toolbar>
    <div id="accordion">
      <mat-accordion multi="true">
        <mat-expansion-panel *ngIf="groupProfile.events.length > 0" expanded>
          <mat-expansion-panel-header>
            <mat-panel-title>
              Events
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div class="list">
            <mat-card class="card" *ngFor="let event of groupProfile.events"
                      [class.selected]="event === selectedEvent"
                      tabindex="0">
              <mat-card-header>
                <mat-card-title>{{event.name}}</mat-card-title>
                <mat-card-subtitle>{{event.date}}</mat-card-subtitle>
                <div class="button-box">
                  <button *ngIf="!event.joined" mat-icon-button class="request-button"
                          matTooltip="join event" matTooltipShowDelay="500"
                          (click)="joinEvent(event)">
                    <mat-icon>event_available</mat-icon>
                  </button>
                  <button *ngIf="event.joined" mat-icon-button class="request-button"
                          matTooltip="leave event" matTooltipShowDelay="500"
                          (click)="leaveEvent(event)"
                          [disabled]="!event.joined">
                    <mat-icon>event_busy</mat-icon>
                  </button>
                </div>
              </mat-card-header>
            </mat-card>
          </div>
        </mat-expansion-panel>
        <mat-expansion-panel expanded>
          <mat-expansion-panel-header>
            <mat-panel-title>
              Members
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div class="list">
            <user-list [userList]="groupProfile.members"></user-list>
          </div>
        </mat-expansion-panel>
        <mat-expansion-panel expanded>
          <mat-expansion-panel-header>
            <mat-panel-title>
              Admins
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div id="list">
            <mat-card class="card" *ngFor="let admin of groupProfile.admins"
                      [class.selected]="admin === selectedAdmin"
                      tabindex="0">
              <mat-card-header>
                <div id="button-box">
                  <button mat-icon-button [matMenuTriggerFor]="menu" id="menu-button">
                    <mat-icon>more_vert</mat-icon>
                  </button>
                  <mat-menu #menu="matMenu">
                    <button mat-menu-item (click)="removeFriend(friend)">
                      <span>remove friend</span>
                    </button>
                  </mat-menu>
                </div>
                <div mat-card-avatar (click)="showFriendProfile(admin)">
                  <img class="profile-picture-small" [src]="admin.profilePicture"/>
                </div>
                <mat-card-title (click)="showFriendProfile(admin)">{{admin.username}}</mat-card-title>
                <mat-card-subtitle (click)="showFriendProfile(admin)">{{admin.handle}}</mat-card-subtitle>
              </mat-card-header>
            </mat-card>
          </div>
        </mat-expansion-panel>
      </mat-accordion>
    </div>
  </div>
  <div id="profilecontainer" *ngIf="groupNotFound">
    <h1>Group not found :(</h1>
  </div>
  <mat-spinner *ngIf="loading" style="margin:0 auto; margin-top: 10em;" diameter="100"></mat-spinner>
</div>

